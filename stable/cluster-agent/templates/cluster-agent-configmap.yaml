{{- if or .Values.clusterAgent.config.override (and .Values.clusterChecks.enabled .Values.dependencies.kubeStateMetrics.enabled) }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "cluster-agent.fullname" . }}
  labels:
{{ include "cluster-agent.labels" . | indent 4 }}
    app.kubernetes.io/component: cluster-agent
data:
{{- if (and .Values.clusterChecks.enabled .Values.dependencies.kubeStateMetrics.enabled) }}
  _etc_stackstate-agent_conf.d_kubernetes_state.d_conf.yaml: |
    cluster_check: true
    init_config:
    instances:
      - kube_state_url: http://%%host%%:8080/metrics
{{- end }}
{{- range .Values.clusterAgent.config.override }}
  {{ .path | replace "/" "_"}}_{{ .name }}: |
{{ .data | indent 4 -}}
{{- end -}}
{{- end -}}
