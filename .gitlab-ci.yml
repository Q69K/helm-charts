################################################################
# THIS FILE WAS GENERATED AUTOMATICALLY! DO NOT EDIT MANUALLY! #
################################################################
image: quay.io/helmpack/chart-testing:v3.0.0-beta.2
push_stable/aws-amicleaner:
  only:
    changes:
      - stable/aws-amicleaner/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/aws-amicleaner
push_stable/aws-nuke:
  only:
    changes:
      - stable/aws-nuke/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/aws-nuke
push_stable/cluster-agent:
  only:
    changes:
      - stable/cluster-agent/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/cluster-agent
push_stable/common:
  only:
    changes:
      - stable/common/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/common
push_stable/distributed:
  only:
    changes:
      - stable/distributed/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/distributed
push_stable/elasticsearch:
  only:
    changes:
      - stable/elasticsearch/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/elasticsearch
push_stable/gitlab-runner:
  only:
    changes:
      - stable/gitlab-runner/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/gitlab-runner
push_stable/gitlab-steward:
  only:
    changes:
      - stable/gitlab-steward/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/gitlab-steward
push_stable/hbase:
  only:
    changes:
      - stable/hbase/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/hbase
push_stable/iceman:
  only:
    changes:
      - stable/iceman/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/iceman
push_stable/stackstate:
  only:
    changes:
      - stable/stackstate/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/stackstate
push_stable/stackstate-standalone:
  only:
    changes:
      - stable/stackstate-standalone/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/stackstate-standalone
push_stable/trafficmirror:
  only:
    changes:
      - stable/trafficmirror/**/*
    refs:
      - merge_requests
  script:
    - helm plugin install https://github.com/chartmuseum/helm-push.git
    - helm push --username ${CHARTMUSEUM_INTERNAL_USERNAME} --password ${CHARTMUSEUM_INTERNAL_PASSWORD} ${CHART} ${CHARTMUSEUM_INTERNAL_URL}
  stage: test
  variables:
    CHART: stable/trafficmirror
push_stable_charts:
  before_script:
    - .gitlab/push_before_script.sh
    - helm repo add bitnami https://charts.bitnami.com/bitnami
    - helm repo add elastic https://helm.elastic.co
    - helm repo add stable https://kubernetes-charts.storage.googleapis.com
    - helm repo add stackstate https://helm.stackstate.io
    - helm repo add stackstate-test https://helm-test.stackstate.io
    - helm repo update
  only:
    refs:
      - master
  script:
    - sh test/sync-repo.sh
  stage: build
  when: manual
push_test_charts:
  before_script:
    - .gitlab/push_before_script.sh
    - helm repo add bitnami https://charts.bitnami.com/bitnami
    - helm repo add elastic https://helm.elastic.co
    - helm repo add stable https://kubernetes-charts.storage.googleapis.com
    - helm repo add stackstate https://helm.stackstate.io
    - helm repo add stackstate-test https://helm-test.stackstate.io
    - helm repo update
  except:
    refs:
      - master
  needs:
    - validate_charts
  only:
    refs:
      - branches
  script:
    - sh test/sync-repo.sh
  stage: build
  variables:
    AWS_BUCKET: s3://helm-test.stackstate.io
    REPO_URL: https://helm-test.stackstate.io/
stages:
  - test
  - build
validate_charts:
  before_script:
    - .gitlab/validate_before_script.sh
  environment: stseuw1-sandbox-main-eks-sandbox/${CI_COMMIT_REF_NAME}
  except:
    refs:
      - master
  only:
    refs:
      - branches
  script:
    - ct list-changed --config test/ct.yaml
    - ct lint --debug --config test/ct.yaml
    - .gitlab/validate_kubeval.sh
  stage: test
variables:
  HELM_VERSION: v3.1.2
  KUBEVAL_SCHEMA_LOCATION: https://raw.githubusercontent.com/instrumenta/kubernetes-json-schema/master
