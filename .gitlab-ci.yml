################################################################
# THIS FILE WAS GENERATED AUTOMATICALLY! DO NOT EDIT MANUALLY! #
################################################################
image: quay.io/helmpack/chart-testing:v3.0.0-beta.2
push_stable_charts:
  before_script:
    - .gitlab/push_before_script.sh
    - helm repo add bitnami https://charts.bitnami.com/bitnami
    - helm repo add elastic https://helm.elastic.co
    - helm repo add stable https://kubernetes-charts.storage.googleapis.com
    - helm repo add stackstate https://helm.stackstate.io
    - helm repo add stackstate-test https://helm-test.stackstate.io
    - helm repo update
  only:
    refs:
      - master
  script:
    - sh test/sync-repo.sh
  stage: build
  when: manual
push_test_charts:
  before_script:
    - .gitlab/push_before_script.sh
    - helm repo add bitnami https://charts.bitnami.com/bitnami
    - helm repo add elastic https://helm.elastic.co
    - helm repo add stable https://kubernetes-charts.storage.googleapis.com
    - helm repo add stackstate https://helm.stackstate.io
    - helm repo add stackstate-test https://helm-test.stackstate.io
    - helm repo update
  except:
    refs:
      - master
  needs:
    - validate_charts
  only:
    refs:
      - branches
  script:
    - sh test/sync-repo.sh
  stage: build
  variables:
    AWS_BUCKET: s3://helm-test.stackstate.io
    REPO_URL: https://helm-test.stackstate.io/
stages:
  - test
  - build
validate_charts:
  before_script:
    - .gitlab/validate_before_script.sh
  environment: stseuw1-sandbox-main-eks-sandbox/${CI_COMMIT_REF_NAME}
  except:
    refs:
      - master
  only:
    refs:
      - branches
  script:
    - ct list-changed --config test/ct.yaml
    - ct lint --debug --config test/ct.yaml
    - .gitlab/validate_kubeval.sh
  stage: test
variables:
  HELM_VERSION: v3.1.2
  KUBEVAL_SCHEMA_LOCATION: https://raw.githubusercontent.com/instrumenta/kubernetes-json-schema/master
