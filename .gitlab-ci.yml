image: quay.io/helmpack/chart-testing:v2.4.0

stages:
  - test
  - build

validate:
  before_script:
    - .gitlab/validate_before_script.sh
  only:
    refs:
      - branches
  except:
    refs:
      - master
  script:
    - ct list-changed --config test/ct.yaml
    - ct lint --debug --config test/ct.yaml
    - .gitlab/validate_kubeval.sh
  stage: test

push:
  before_script:
    - .gitlab/push_before_script.sh
  only:
    refs:
      - master
  script:
    - sh test/sync-repo.sh
  stage: build
